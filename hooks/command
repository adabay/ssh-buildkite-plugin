#!/bin/bash

IFS=$'\n'
for command in $BUILDKITE_COMMAND
do
    rawCommand=$(echo $command | cut -d " " -f 1)

    echo "Processing command $rawCommand ..."

    if [[ -f $rawCommand ]] ; then
        echo "Executing local script at path $rawCommand on remote server."
        echo "ssh user@server \"bash -s\" -- < $command"
    else
        echo "command -v $rawCommand"
        rawCommandSource=$(command -v $rawCommand)
        if [ $? -eq 0 ]; then
            echo "Command $rawCommand found: $rawCommandSource"
            echo "ssh user@server \"bash -s\" -- < $command"
        else
            echo "Command $rawCommand not found. Aborting pipeline execution."
            exit 1
        fi
    fi
done